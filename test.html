<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<script src="SampleBank.js"></script>
<script src="WebDirt.js"></script>
<script src="Graph.js"></script>
<script>
var webDirt;

function onload() {
  webDirt = new WebDirt();
}

WebDirt.prototype.testWebAudioIsWorking = function() {
  var sine = this.ac.createOscillator();
	sine.type = 'sine';
	sine.frequency.value = 440;
	var gain = this.ac.createGain();
	sine.connect(gain);
	gain.connect(this.ac.destination);
	sine.start();
	// envelope
	var now = this.ac.currentTime;
	gain.gain.setValueAtTime(0,now);
  gain.gain.linearRampToValueAtTime(1,now+0.005);
  gain.gain.linearRampToValueAtTime(0,now+0.405);
}

WebDirt.prototype.testSampleBankGetsBuffer = function() {
  var source = this.ac.createBufferSource();
  source.buffer = this.sampleBank.getBuffer('cp',0);
  source.connect(this.ac.destination);
  var soon = this.ac.currentTime+0.1;
  source.start(soon);
}

WebDirt.prototype.testPlaybackOfSimpleMessage = function(){
  var msg = { sample_name: 'cp', sample_n:0, when:0 };
  queue(msg);
}

WebDirt.prototype.testComplexMessage = function() {
  var msg = {};
  msg.sample_name = document.getElementById('sample_name');
  msg.sample_n = document.getElementById('sample_n');
  msg.speed = document.getElementById('speed');
  msg.shape = document.getElementById('shape');
  msg.when = this.ac.currentTime+0.1;
  queue(msg);
}

</script>
</head>
<body onload="onload()">
  <div>WebDirt test page</div>
  <button onclick="webDirt.testWebAudioIsWorking()">testWebAudioIsWorking</button>
  <button onclick="webDirt.testSampleBankGetsBuffer()">testSampleBankGetsBuffer</button>
  <button onclick="webDirt.testPlaybackOfSimpleMessage()">testPlaybackOfSimpleMessage</button>
  <div border="1px solid black">
    <div>sample_name: <textarea id="sample_name"></textarea></div>
    <div>sample_n: <textarea id="sample_n"></textarea></div>
    <div>speed: <textarea id="speed"></textarea></div>
    <div>shape: <textarea id="shape"></textarea></div>
    <button onclick="webDirt.testComplexMessage()">testComplexMessage</button>
  </div>
</body>
</html>
